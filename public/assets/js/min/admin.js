$(function(){function e(e){this.classList.add("dragging"),o=this,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML)}function t(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1}function a(e){this.classList.add("drag-over")}function r(e){this.classList.remove("drag-over")}function n(e){function t(e){for(var t=e.parentNode.parentNode.getElementsByTagName("li"),a=t.length,r,n=0;a>n;n++)if(t[n]==e)return r=n,r+1}return e.stopPropagation&&e.stopPropagation(),o!=this&&(o.innerHTML=this.innerHTML,this.innerHTML=e.dataTransfer.getData("text/html"),[].forEach.call(d,function(e){e.classList.remove("drag-over"),e.classList.remove("dragging");var a=t(e),r=e.getElementsByClassName("sort-order")[0];r.value=a}),s.classList.remove("inactive"),s.classList.add("active"),e.preventDefault()),!1}function i(e){return[].forEach.call(d,function(e){e.classList.remove("drag-over"),e.classList.remove("dragging")}),!1}$(".date-select").datepicker({format:"yyyy-mm-dd",autoclose:!0}).on("changeDate",function(){$(".datepicker").hide()}),$("form[data-confirm]").submit(function(){return confirm($(this).attr("data-confirm"))?void 0:!1}),$(".move-up").on("click",function(){var e=$(this).closest(".draggable"),t=e.prev(),a=e.find(".sort-order"),r=parseInt(a.val()),n=e.prev().find(".sort-order"),i=parseInt(n.val());e.insertBefore(t).fadeIn(),1!=r&&a.val(r-1),n.val(i+1),$(".button").removeClass("inactive").addClass("active")}),$(".move-down").on("click",function(){var e=$(this).closest(".draggable"),t=e.next(),a=e.find(".sort-order"),r=parseInt(a.val()),n=e.next().find(".sort-order"),i=parseInt(n.val());e.insertAfter(t).fadeIn(300),a.val(r+1),n.val(i-1),$(".button").removeClass("inactive").addClass("active")});var o=null,s=document.getElementById("submit"),d=document.querySelectorAll(".draggable");[].forEach.call(d,function(o){o.addEventListener("dragstart",e,!1),o.addEventListener("dragenter",a,!1),o.addEventListener("dragover",t,!1),o.addEventListener("dragleave",r,!1),o.addEventListener("dragend",i,!1),o.addEventListener("drop",n,!1)});var c=$("[data-preview]");c.each(function(e,t){var a=$(t);a.on("click",function(e){var t=a.data("preview"),r=$("#"+t),n=r.val(),i=$(a.attr("href"));i.html("<p>...loading preview</p>");var o=$.post("/markdown",{text:n}).done(function(e){i.html(e)})})})});